<?php

/*
    Sử dụng pdo để ngăn chặn lỗ hổng sql ịnection */
if (isset($_GET['id'])){
  $id = $_GET['id'];
  
   if ( is_numeric($id) == true){
    try{ 
      
      $dbh = new PDO('mysql:host=localhost;dbname=sql_injection_example', 'dbuser', 'dbpasswd');
      
      
      $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
      
      
      $q = "SELECT username 
          FROM users
          WHERE id = :id";
      $sth = $dbh->prepare($q);
      $sth->bindParam(':id', $id);
      $sth->execute();
      $sth->setFetchMode(PDO::FETCH_ASSOC);
      $result = $sth->fetchColumn();
      
      print( htmlentities($result) );
      
      $dbh = null;
    }
    catch(PDOException $e){
      
      error_log('PDOException - ' . $e->getMessage(), 0);
     
      http_response_code(500);
      die('Error establishing connection with database');
    }
   } else{
    
    http_response_code(400);
    die('Error processing bad or malformed request');
   }
}